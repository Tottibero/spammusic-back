@baseUrl = http://localhost:3000/api
@username = tottibero
@password = Spammusic2025

### =========================================
# LOGIN
# =========================================
# @name login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "{{username}}",
  "password": "{{password}}"
}

### =========================================
# 1. CREAR ITEM INDEPENDIENTE (BACKLOG)
# =========================================
# @name createBacklogItem
POST {{baseUrl}}/versions/items
Content-Type: application/json
Authorization: Bearer {{login.response.body.access_token}}

{
  "type": "refactor",
  "description": "Refactorizar módulo de auth",
  "branch": "refactor/auth-module",
  "state": "todo"
}

### =========================================
# 2. LISTAR ITEMS INDEPENDIENTES
# =========================================
GET {{baseUrl}}/versions/items
Authorization: Bearer {{login.response.body.access_token}}

### =========================================
# 3. ACTUALIZAR ITEM INDEPENDIENTE
# =========================================
PATCH {{baseUrl}}/versions/items/{{createBacklogItem.response.body.id}}
Content-Type: application/json
Authorization: Bearer {{login.response.body.access_token}}

{
  "description": "Refactorizar módulo de auth (actualizado)"
}

### =========================================
# 3.1 INTENTAR CAMBIAR ESTADO DE ITEM INDEPENDIENTE (Debe fallar)
# =========================================
PATCH {{baseUrl}}/versions/items/{{createBacklogItem.response.body.id}}
Content-Type: application/json
Authorization: Bearer {{login.response.body.access_token}}

{
  "state": "in_progress"
}

### =========================================
# 4. PREPARACIÓN: CREAR UNA VERSIÓN
# =========================================
# @name createDevVersion
POST {{baseUrl}}/versions
Content-Type: application/json
Authorization: Bearer {{login.response.body.access_token}}

{
  "version": "1.3.0",
  "releaseDate": "2026-02-01",
  "notes": "Versión para probar asignación"
}

### =========================================
# 5. ASIGNAR ITEM A LA VERSIÓN
# =========================================
PATCH {{baseUrl}}/versions/items/{{createBacklogItem.response.body.id}}
Content-Type: application/json
Authorization: Bearer {{login.response.body.access_token}}

{
  "version": "{{createDevVersion.response.body.id}}"
}

### =========================================
# 5.1 CAMBIAR ESTADO A IN_PROGRESS (Ahora debe funcionar)
# =========================================
PATCH {{baseUrl}}/versions/items/{{createBacklogItem.response.body.id}}
Content-Type: application/json
Authorization: Bearer {{login.response.body.access_token}}

{
  "state": "in_progress"
}

### =========================================
# 6. DESASIGNAR ITEM DE LA VERSIÓN (Volver a backlog)
# =========================================
PATCH {{baseUrl}}/versions/items/{{createBacklogItem.response.body.id}}
Content-Type: application/json
Authorization: Bearer {{login.response.body.access_token}}

{
  "version": null
}

### =========================================
# 7. BORRAR ITEM INDEPENDIENTE
# =========================================
DELETE {{baseUrl}}/versions/items/{{createBacklogItem.response.body.id}}
Authorization: Bearer {{login.response.body.access_token}}

### =========================================
# 8. LIMPIEZA: BORRAR VERSIÓN CREADA
# =========================================
### =========================================
# 9. OBTENER ESTADO DE DESARROLLO
# =========================================
GET {{baseUrl}}/versions/dev/status
Authorization: Bearer {{login.response.body.access_token}}
